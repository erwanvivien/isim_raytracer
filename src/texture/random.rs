use crate::color::Color;
use crate::point::Point;
use crate::texture::{GetColor, LightCoefficients, TextureTrait};
use crate::Vector;
use rand::rngs::StdRng;
use rand::{Rng, SeedableRng};

pub struct RandomTexture {
    pub kd: f64, // diffusion
    pub ks: f64, // specularite
    pub ka: f64, // ambiance

    pub seed: usize,
}

impl LightCoefficients for RandomTexture {
    fn coefficients(&self, _point: Point) -> (f64, f64, f64) {
        (self.kd, self.ks, self.ka)
    }
}

const COLORS: [Color; 360] = [
    Color::new(255, 128, 128),
    Color::new(255, 130, 128),
    Color::new(255, 132, 128),
    Color::new(255, 134, 128),
    Color::new(255, 136, 128),
    Color::new(255, 138, 128),
    Color::new(255, 140, 128),
    Color::new(255, 142, 128),
    Color::new(255, 145, 128),
    Color::new(255, 147, 128),
    Color::new(255, 149, 128),
    Color::new(255, 151, 128),
    Color::new(255, 153, 128),
    Color::new(255, 155, 128),
    Color::new(255, 157, 128),
    Color::new(255, 159, 128),
    Color::new(255, 162, 128),
    Color::new(255, 164, 128),
    Color::new(255, 166, 128),
    Color::new(255, 168, 128),
    Color::new(255, 170, 128),
    Color::new(255, 172, 128),
    Color::new(255, 174, 128),
    Color::new(255, 176, 128),
    Color::new(255, 179, 128),
    Color::new(255, 181, 128),
    Color::new(255, 183, 128),
    Color::new(255, 185, 128),
    Color::new(255, 187, 128),
    Color::new(255, 189, 128),
    Color::new(255, 191, 128),
    Color::new(255, 193, 128),
    Color::new(255, 195, 128),
    Color::new(255, 198, 128),
    Color::new(255, 200, 128),
    Color::new(255, 202, 128),
    Color::new(255, 204, 128),
    Color::new(255, 206, 128),
    Color::new(255, 208, 128),
    Color::new(255, 210, 128),
    Color::new(255, 212, 128),
    Color::new(255, 215, 128),
    Color::new(255, 217, 128),
    Color::new(255, 219, 128),
    Color::new(255, 221, 128),
    Color::new(255, 223, 128),
    Color::new(255, 225, 128),
    Color::new(255, 227, 128),
    Color::new(255, 230, 128),
    Color::new(255, 232, 128),
    Color::new(255, 234, 128),
    Color::new(255, 236, 128),
    Color::new(255, 238, 128),
    Color::new(255, 240, 128),
    Color::new(255, 242, 128),
    Color::new(255, 244, 128),
    Color::new(255, 247, 128),
    Color::new(255, 249, 128),
    Color::new(255, 251, 128),
    Color::new(255, 253, 128),
    Color::new(255, 255, 128),
    Color::new(253, 255, 128),
    Color::new(251, 255, 128),
    Color::new(249, 255, 128),
    Color::new(247, 255, 128),
    Color::new(244, 255, 128),
    Color::new(242, 255, 128),
    Color::new(240, 255, 128),
    Color::new(238, 255, 128),
    Color::new(236, 255, 128),
    Color::new(234, 255, 128),
    Color::new(232, 255, 128),
    Color::new(230, 255, 128),
    Color::new(227, 255, 128),
    Color::new(225, 255, 128),
    Color::new(223, 255, 128),
    Color::new(221, 255, 128),
    Color::new(219, 255, 128),
    Color::new(217, 255, 128),
    Color::new(215, 255, 128),
    Color::new(213, 255, 128),
    Color::new(210, 255, 128),
    Color::new(208, 255, 128),
    Color::new(206, 255, 128),
    Color::new(204, 255, 128),
    Color::new(202, 255, 128),
    Color::new(200, 255, 128),
    Color::new(198, 255, 128),
    Color::new(196, 255, 128),
    Color::new(193, 255, 128),
    Color::new(191, 255, 128),
    Color::new(189, 255, 128),
    Color::new(187, 255, 128),
    Color::new(185, 255, 128),
    Color::new(183, 255, 128),
    Color::new(181, 255, 128),
    Color::new(179, 255, 128),
    Color::new(176, 255, 128),
    Color::new(174, 255, 128),
    Color::new(172, 255, 128),
    Color::new(170, 255, 128),
    Color::new(168, 255, 128),
    Color::new(166, 255, 128),
    Color::new(164, 255, 128),
    Color::new(162, 255, 128),
    Color::new(159, 255, 128),
    Color::new(157, 255, 128),
    Color::new(155, 255, 128),
    Color::new(153, 255, 128),
    Color::new(151, 255, 128),
    Color::new(149, 255, 128),
    Color::new(147, 255, 128),
    Color::new(145, 255, 128),
    Color::new(142, 255, 128),
    Color::new(140, 255, 128),
    Color::new(138, 255, 128),
    Color::new(136, 255, 128),
    Color::new(134, 255, 128),
    Color::new(132, 255, 128),
    Color::new(130, 255, 128),
    Color::new(128, 255, 128),
    Color::new(128, 255, 130),
    Color::new(128, 255, 132),
    Color::new(128, 255, 134),
    Color::new(128, 255, 136),
    Color::new(128, 255, 138),
    Color::new(128, 255, 140),
    Color::new(128, 255, 142),
    Color::new(128, 255, 145),
    Color::new(128, 255, 147),
    Color::new(128, 255, 149),
    Color::new(128, 255, 151),
    Color::new(128, 255, 153),
    Color::new(128, 255, 155),
    Color::new(128, 255, 157),
    Color::new(128, 255, 159),
    Color::new(128, 255, 162),
    Color::new(128, 255, 164),
    Color::new(128, 255, 166),
    Color::new(128, 255, 168),
    Color::new(128, 255, 170),
    Color::new(128, 255, 172),
    Color::new(128, 255, 174),
    Color::new(128, 255, 176),
    Color::new(128, 255, 179),
    Color::new(128, 255, 181),
    Color::new(128, 255, 183),
    Color::new(128, 255, 185),
    Color::new(128, 255, 187),
    Color::new(128, 255, 189),
    Color::new(128, 255, 191),
    Color::new(128, 255, 193),
    Color::new(128, 255, 195),
    Color::new(128, 255, 198),
    Color::new(128, 255, 200),
    Color::new(128, 255, 202),
    Color::new(128, 255, 204),
    Color::new(128, 255, 206),
    Color::new(128, 255, 208),
    Color::new(128, 255, 210),
    Color::new(128, 255, 212),
    Color::new(128, 255, 215),
    Color::new(128, 255, 217),
    Color::new(128, 255, 219),
    Color::new(128, 255, 221),
    Color::new(128, 255, 223),
    Color::new(128, 255, 225),
    Color::new(128, 255, 227),
    Color::new(128, 255, 229),
    Color::new(128, 255, 232),
    Color::new(128, 255, 234),
    Color::new(128, 255, 236),
    Color::new(128, 255, 238),
    Color::new(128, 255, 240),
    Color::new(128, 255, 242),
    Color::new(128, 255, 244),
    Color::new(128, 255, 246),
    Color::new(128, 255, 249),
    Color::new(128, 255, 251),
    Color::new(128, 255, 253),
    Color::new(128, 255, 255),
    Color::new(128, 253, 255),
    Color::new(128, 251, 255),
    Color::new(128, 249, 255),
    Color::new(128, 246, 255),
    Color::new(128, 244, 255),
    Color::new(128, 242, 255),
    Color::new(128, 240, 255),
    Color::new(128, 238, 255),
    Color::new(128, 236, 255),
    Color::new(128, 234, 255),
    Color::new(128, 232, 255),
    Color::new(128, 229, 255),
    Color::new(128, 227, 255),
    Color::new(128, 225, 255),
    Color::new(128, 223, 255),
    Color::new(128, 221, 255),
    Color::new(128, 219, 255),
    Color::new(128, 217, 255),
    Color::new(128, 215, 255),
    Color::new(128, 212, 255),
    Color::new(128, 210, 255),
    Color::new(128, 208, 255),
    Color::new(128, 206, 255),
    Color::new(128, 204, 255),
    Color::new(128, 202, 255),
    Color::new(128, 200, 255),
    Color::new(128, 198, 255),
    Color::new(128, 195, 255),
    Color::new(128, 193, 255),
    Color::new(128, 191, 255),
    Color::new(128, 189, 255),
    Color::new(128, 187, 255),
    Color::new(128, 185, 255),
    Color::new(128, 183, 255),
    Color::new(128, 181, 255),
    Color::new(128, 179, 255),
    Color::new(128, 176, 255),
    Color::new(128, 174, 255),
    Color::new(128, 172, 255),
    Color::new(128, 170, 255),
    Color::new(128, 168, 255),
    Color::new(128, 166, 255),
    Color::new(128, 164, 255),
    Color::new(128, 162, 255),
    Color::new(128, 159, 255),
    Color::new(128, 157, 255),
    Color::new(128, 155, 255),
    Color::new(128, 153, 255),
    Color::new(128, 151, 255),
    Color::new(128, 149, 255),
    Color::new(128, 147, 255),
    Color::new(128, 145, 255),
    Color::new(128, 142, 255),
    Color::new(128, 140, 255),
    Color::new(128, 138, 255),
    Color::new(128, 136, 255),
    Color::new(128, 134, 255),
    Color::new(128, 132, 255),
    Color::new(128, 130, 255),
    Color::new(128, 128, 255),
    Color::new(130, 128, 255),
    Color::new(132, 128, 255),
    Color::new(134, 128, 255),
    Color::new(136, 128, 255),
    Color::new(138, 128, 255),
    Color::new(140, 128, 255),
    Color::new(142, 128, 255),
    Color::new(145, 128, 255),
    Color::new(147, 128, 255),
    Color::new(149, 128, 255),
    Color::new(151, 128, 255),
    Color::new(153, 128, 255),
    Color::new(155, 128, 255),
    Color::new(157, 128, 255),
    Color::new(159, 128, 255),
    Color::new(162, 128, 255),
    Color::new(164, 128, 255),
    Color::new(166, 128, 255),
    Color::new(168, 128, 255),
    Color::new(170, 128, 255),
    Color::new(172, 128, 255),
    Color::new(174, 128, 255),
    Color::new(176, 128, 255),
    Color::new(179, 128, 255),
    Color::new(181, 128, 255),
    Color::new(183, 128, 255),
    Color::new(185, 128, 255),
    Color::new(187, 128, 255),
    Color::new(189, 128, 255),
    Color::new(191, 128, 255),
    Color::new(193, 128, 255),
    Color::new(195, 128, 255),
    Color::new(198, 128, 255),
    Color::new(200, 128, 255),
    Color::new(202, 128, 255),
    Color::new(204, 128, 255),
    Color::new(206, 128, 255),
    Color::new(208, 128, 255),
    Color::new(210, 128, 255),
    Color::new(213, 128, 255),
    Color::new(215, 128, 255),
    Color::new(217, 128, 255),
    Color::new(219, 128, 255),
    Color::new(221, 128, 255),
    Color::new(223, 128, 255),
    Color::new(225, 128, 255),
    Color::new(227, 128, 255),
    Color::new(229, 128, 255),
    Color::new(232, 128, 255),
    Color::new(234, 128, 255),
    Color::new(236, 128, 255),
    Color::new(238, 128, 255),
    Color::new(240, 128, 255),
    Color::new(242, 128, 255),
    Color::new(244, 128, 255),
    Color::new(247, 128, 255),
    Color::new(249, 128, 255),
    Color::new(251, 128, 255),
    Color::new(253, 128, 255),
    Color::new(255, 128, 255),
    Color::new(255, 128, 253),
    Color::new(255, 128, 251),
    Color::new(255, 128, 249),
    Color::new(255, 128, 247),
    Color::new(255, 128, 244),
    Color::new(255, 128, 242),
    Color::new(255, 128, 240),
    Color::new(255, 128, 238),
    Color::new(255, 128, 236),
    Color::new(255, 128, 234),
    Color::new(255, 128, 232),
    Color::new(255, 128, 229),
    Color::new(255, 128, 227),
    Color::new(255, 128, 225),
    Color::new(255, 128, 223),
    Color::new(255, 128, 221),
    Color::new(255, 128, 219),
    Color::new(255, 128, 217),
    Color::new(255, 128, 215),
    Color::new(255, 128, 213),
    Color::new(255, 128, 210),
    Color::new(255, 128, 208),
    Color::new(255, 128, 206),
    Color::new(255, 128, 204),
    Color::new(255, 128, 202),
    Color::new(255, 128, 200),
    Color::new(255, 128, 198),
    Color::new(255, 128, 195),
    Color::new(255, 128, 193),
    Color::new(255, 128, 191),
    Color::new(255, 128, 189),
    Color::new(255, 128, 187),
    Color::new(255, 128, 185),
    Color::new(255, 128, 183),
    Color::new(255, 128, 181),
    Color::new(255, 128, 179),
    Color::new(255, 128, 176),
    Color::new(255, 128, 174),
    Color::new(255, 128, 172),
    Color::new(255, 128, 170),
    Color::new(255, 128, 168),
    Color::new(255, 128, 166),
    Color::new(255, 128, 164),
    Color::new(255, 128, 162),
    Color::new(255, 128, 159),
    Color::new(255, 128, 157),
    Color::new(255, 128, 155),
    Color::new(255, 128, 153),
    Color::new(255, 128, 151),
    Color::new(255, 128, 149),
    Color::new(255, 128, 147),
    Color::new(255, 128, 145),
    Color::new(255, 128, 142),
    Color::new(255, 128, 140),
    Color::new(255, 128, 138),
    Color::new(255, 128, 136),
    Color::new(255, 128, 134),
    Color::new(255, 128, 132),
    Color::new(255, 128, 130),
];

impl GetColor for RandomTexture {
    fn color(&self, point: Point) -> Color {
        // let point = point.normalize() * std::f64::consts::PI;
        let seed = [
            (point - Vector::new(0f64, 0f64, 0f64) * 20f64),
            (point - Vector::new(0f64, 0f64, 1f64) * 20f64),
            (point - Vector::new(0f64, 1f64, 0f64) * 20f64),
            (point - Vector::new(0f64, 1f64, 1f64) * 20f64),
            (point - Vector::new(1f64, 0f64, 0f64) * 20f64),
            (point - Vector::new(1f64, 0f64, 1f64) * 20f64),
            (point - Vector::new(1f64, 1f64, 0f64) * 20f64),
            (point - Vector::new(1f64, 1f64, 1f64) * 20f64),
            // (point - Vector::ONE).powf(2f64).sum(),
        ]
        .iter()
        .map(|x| x.powf(2f64).sum())
        .min_by(|&x, y| x.partial_cmp(y).unwrap())
        .unwrap();

        let mut rng = StdRng::seed_from_u64(seed as u64 * 7);
        COLORS[(rng.gen::<usize>() + self.seed * 8) % 360]
    }
}

impl TextureTrait for RandomTexture {}
